{"version":3,"sources":["webpack:///./App/Containers/ResetPasswordModal/reset-password-modal.jsx"],"names":["resetInitialValues","password","ResetPassword","onResetComplete","error_msg","actions","setSubmitting","resetForm","console","error","setStatus","reset_complete","props","logoutClient","then","redirectToLogin","is_logged_in","getLanguage","handleSubmit","values","verification_code","api_request","reset_password","new_password","WS","resetPassword","response","message","validateReset","errors","validLength","min","max","validPassword","getErrorMessages","localize","min_number","max_number","className","initialValues","initialStatus","validate","this","onSubmit","handleBlur","touched","isSubmitting","handleChange","status","i18n_default_text","input","has_error","custom_feedback_messages","password_warnings","name","label","onChange","onBlur","value","data-lpignore","required","classNames","type","is_disabled","primary","React","propTypes","enableApp","PropTypes","func","isModalVisible","string","ResetPasswordModal","disableApp","is_loading","is_visible","toggleResetPasswordModal","bool","connect","ui","client","is_reset_password_modal_visible","logout"],"mappings":"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","file":"js/core.reset-password-modal.ac9a34dda27b90445092.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { Formik, Form } from 'formik';\nimport { Button, Dialog, PasswordInput, PasswordMeter } from '@deriv/components';\nimport { redirectToLogin, validPassword, validLength, getErrorMessages } from '@deriv/shared';\nimport { getLanguage, localize, Localize } from '@deriv/translations';\nimport { connect } from 'Stores/connect';\nimport { WS } from 'Services/index';\n\nconst resetInitialValues = { password: '' };\n\nclass ResetPassword extends React.Component {\n    onResetComplete = (error_msg, actions) => {\n        actions.setSubmitting(false);\n        actions.resetForm({ password: '' });\n        // Error would be returned on invalid token (and the like) cases.\n        // TODO: Proper error handling (currently we have no place to put the message)\n        if (error_msg) {\n            // eslint-disable-next-line no-console\n            console.error(error_msg);\n            actions.setStatus({ error_msg });\n            return;\n        }\n\n        actions.setStatus({ reset_complete: true });\n\n        this.props.logoutClient().then(() => {\n            redirectToLogin(this.props.is_logged_in, getLanguage());\n        });\n    };\n\n    handleSubmit = (values, actions) => {\n        const { verification_code } = this.props;\n        const api_request = {\n            reset_password: 1,\n            new_password: values.password,\n            verification_code,\n        };\n\n        WS.resetPassword(api_request).then(async response => {\n            if (response.error) {\n                this.onResetComplete(response.error.message, actions);\n            } else {\n                this.onResetComplete(null, actions);\n            }\n        });\n    };\n\n    validateReset = values => {\n        const errors = {};\n\n        if (\n            !validLength(values.password, {\n                min: 8,\n                max: 25,\n            })\n        ) {\n            errors.password = localize('You should enter {{min_number}}-{{max_number}} characters.', {\n                min_number: 8,\n                max_number: 25,\n            });\n        } else if (!validPassword(values.password)) {\n            errors.password = getErrorMessages().password();\n        }\n\n        return errors;\n    };\n\n    render() {\n        return (\n            <div className='reset-password'>\n                <Formik\n                    initialValues={resetInitialValues}\n                    initialStatus={{ reset_complete: false, error_msg: '' }}\n                    validate={this.validateReset}\n                    onSubmit={this.handleSubmit}\n                >\n                    {({ handleBlur, errors, values, touched, isSubmitting, handleChange, status }) => (\n                        <Form>\n                            <React.Fragment>\n                                {status.reset_complete ? (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Your password has been changed' />\n                                        </p>\n                                        <p className='reset-password__subtext'>\n                                            <Localize i18n_default_text='We will now redirect you to the login page.' />\n                                        </p>\n                                    </div>\n                                ) : (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Choose a new password' />\n                                        </p>\n                                        <fieldset className='reset-password__fieldset'>\n                                            <PasswordMeter\n                                                input={values.password}\n                                                has_error={!!(touched.password && errors.password)}\n                                                custom_feedback_messages={getErrorMessages().password_warnings}\n                                            >\n                                                <PasswordInput\n                                                    className='reset-password__password-field'\n                                                    name='password'\n                                                    label={localize('Create a password')}\n                                                    onChange={handleChange}\n                                                    onBlur={handleBlur}\n                                                    error={touched.password && errors.password}\n                                                    value={values.password}\n                                                    data-lpignore='true'\n                                                    required\n                                                />\n                                            </PasswordMeter>\n                                        </fieldset>\n                                        <p className='reset-password__subtext'>\n                                            {status.error_msg ? (\n                                                <Localize\n                                                    i18n_default_text='{{error_msg}}'\n                                                    values={{ error_msg: status.error_msg }}\n                                                />\n                                            ) : (\n                                                <Localize i18n_default_text='Strong passwords contain at least 8 characters, combine uppercase and lowercase letters, numbers, and symbols.' />\n                                            )}\n                                        </p>\n\n                                        <Button\n                                            className={classNames('reset-password__btn', {\n                                                'reset-password__btn--disabled':\n                                                    !values.password || errors.password || isSubmitting,\n                                            })}\n                                            type='submit'\n                                            is_disabled={!values.password || errors.password || isSubmitting}\n                                            primary\n                                        >\n                                            <Localize i18n_default_text='Reset my password' />\n                                        </Button>\n                                    </div>\n                                )}\n                            </React.Fragment>\n                        </Form>\n                    )}\n                </Formik>\n            </div>\n        );\n    }\n}\n\nResetPassword.propTypes = {\n    enableApp: PropTypes.func,\n    isModalVisible: PropTypes.func,\n    verification_code: PropTypes.string,\n};\n\nconst ResetPasswordModal = ({\n    enableApp,\n    disableApp,\n    is_loading,\n    is_visible,\n    is_logged_in,\n    logoutClient,\n    verification_code,\n    toggleResetPasswordModal,\n}) => {\n    return (\n        <Dialog is_visible={is_visible} disableApp={disableApp} enableApp={enableApp} is_loading={is_loading}>\n            <ResetPassword\n                is_logged_in={is_logged_in}\n                verification_code={verification_code}\n                isModalVisible={toggleResetPasswordModal}\n                enableApp={enableApp}\n                logoutClient={logoutClient}\n            />\n        </Dialog>\n    );\n};\n\nResetPasswordModal.propTypes = {\n    disableApp: PropTypes.func,\n    enableApp: PropTypes.func,\n    is_loading: PropTypes.bool,\n    is_visible: PropTypes.bool,\n    logoutClient: PropTypes.func,\n    toggleResetPasswordModal: PropTypes.func,\n    verification_code: PropTypes.string,\n};\n\nexport default connect(({ ui, client }) => ({\n    is_visible: ui.is_reset_password_modal_visible,\n    enableApp: ui.enableApp,\n    disableApp: ui.disableApp,\n    is_loading: ui.is_loading,\n    is_logged_in: client.is_logged_in,\n    logoutClient: client.logout,\n    toggleResetPasswordModal: ui.toggleResetPasswordModal,\n    verification_code: client.verification_code.reset_password,\n}))(ResetPasswordModal);\n"],"sourceRoot":""}