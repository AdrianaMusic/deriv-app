{"version":3,"sources":["webpack:///./App/Containers/ResetPasswordModal/reset-password-modal.jsx"],"names":["resetInitialValues","password","ResetPassword","onResetComplete","error_msg","actions","setSubmitting","resetForm","console","error","setStatus","reset_complete","props","logoutClient","then","redirectToLogin","handleSubmit","values","verification_code","api_request","reset_password","new_password","WS","resetPassword","response","message","validateReset","errors","length","validPassword","className","initialValues","initialStatus","validate","this","onSubmit","handleBlur","touched","isSubmitting","handleChange","status","i18n_default_text","input","has_error","name","label","localize","onChange","onBlur","value","data-lpignore","required","classNames","type","is_disabled","primary","React","propTypes","enableApp","PropTypes","func","isModalVisible","string","ResetPasswordModal","disableApp","is_loading","is_visible","toggleResetPasswordModal","bool","connect","ui","client","is_reset_password_modal_visible","logout"],"mappings":"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","file":"js/core.reset-password-modal.6c217dff7f0ad10f3034.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'classnames';\nimport { Formik, Form } from 'formik';\nimport { Button, Dialog, PasswordInput, PasswordMeter } from '@deriv/components';\nimport { localize, Localize } from '@deriv/translations';\nimport { connect } from 'Stores/connect';\nimport { validPassword } from 'Utils/Validator/declarative-validation-rules';\nimport { redirectToLogin } from '_common/base/login';\nimport { WS } from 'Services/index';\n\nconst resetInitialValues = { password: '' };\n\nclass ResetPassword extends React.Component {\n    onResetComplete = (error_msg, actions) => {\n        actions.setSubmitting(false);\n        actions.resetForm({ password: '' });\n        // Error would be returned on invalid token (and the like) cases.\n        // TODO: Proper error handling (currently we have no place to put the message)\n        if (error_msg) {\n            // eslint-disable-next-line no-console\n            console.error(error_msg);\n            actions.setStatus({ error_msg });\n            return;\n        }\n\n        actions.setStatus({ reset_complete: true });\n\n        this.props.logoutClient().then(() => {\n            redirectToLogin();\n        });\n    };\n\n    handleSubmit = (values, actions) => {\n        const { verification_code } = this.props;\n        const api_request = {\n            reset_password: 1,\n            new_password: values.password,\n            verification_code,\n        };\n\n        WS.resetPassword(api_request).then(async response => {\n            if (response.error) {\n                this.onResetComplete(response.error.message, actions);\n            } else {\n                this.onResetComplete(null, actions);\n            }\n        });\n    };\n\n    validateReset = values => {\n        const errors = {};\n        const min_password_length = 6;\n\n        if (values.password && (values.password.length < min_password_length || !validPassword(values.password))) {\n            errors.password = true;\n        }\n\n        return errors;\n    };\n\n    render() {\n        return (\n            <div className='reset-password'>\n                <Formik\n                    initialValues={resetInitialValues}\n                    initialStatus={{ reset_complete: false, error_msg: '' }}\n                    validate={this.validateReset}\n                    onSubmit={this.handleSubmit}\n                >\n                    {({ handleBlur, errors, values, touched, isSubmitting, handleChange, status }) => (\n                        <Form>\n                            <React.Fragment>\n                                {status.reset_complete ? (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Your password has been changed' />\n                                        </p>\n                                        <p className='reset-password__subtext'>\n                                            <Localize i18n_default_text='We will now redirect you to the login page.' />\n                                        </p>\n                                    </div>\n                                ) : (\n                                    <div className='reset-password__password-selection'>\n                                        <p className='reset-password__heading'>\n                                            <Localize i18n_default_text='Choose a new password' />\n                                        </p>\n                                        <fieldset className='reset-password__fieldset'>\n                                            <PasswordMeter\n                                                input={values.password}\n                                                has_error={!!(touched.password && errors.password)}\n                                            >\n                                                <PasswordInput\n                                                    className='reset-password__password-field'\n                                                    name='password'\n                                                    label={localize('Create a password')}\n                                                    onChange={handleChange}\n                                                    onBlur={handleBlur}\n                                                    error={touched.password && errors.password}\n                                                    value={values.password}\n                                                    data-lpignore='true'\n                                                    required\n                                                />\n                                            </PasswordMeter>\n                                        </fieldset>\n                                        <p className='reset-password__subtext'>\n                                            {status.error_msg ? (\n                                                <Localize\n                                                    i18n_default_text='{{error_msg}}'\n                                                    values={{ error_msg: status.error_msg }}\n                                                />\n                                            ) : (\n                                                <Localize i18n_default_text='Strong passwords contain at least 6 characters, combine uppercase and lowercase letters, numbers, and symbols.' />\n                                            )}\n                                        </p>\n\n                                        <Button\n                                            className={classNames('reset-password__btn', {\n                                                'reset-password__btn--disabled':\n                                                    !values.password || errors.password || isSubmitting,\n                                            })}\n                                            type='submit'\n                                            is_disabled={!values.password || errors.password || isSubmitting}\n                                            primary\n                                        >\n                                            <Localize i18n_default_text='Reset my password' />\n                                        </Button>\n                                    </div>\n                                )}\n                            </React.Fragment>\n                        </Form>\n                    )}\n                </Formik>\n            </div>\n        );\n    }\n}\n\nResetPassword.propTypes = {\n    enableApp: PropTypes.func,\n    isModalVisible: PropTypes.func,\n    verification_code: PropTypes.string,\n};\n\nconst ResetPasswordModal = ({\n    enableApp,\n    disableApp,\n    is_loading,\n    is_visible,\n    logoutClient,\n    verification_code,\n    toggleResetPasswordModal,\n}) => {\n    return (\n        <Dialog is_visible={is_visible} disableApp={disableApp} enableApp={enableApp} is_loading={is_loading}>\n            <ResetPassword\n                verification_code={verification_code}\n                isModalVisible={toggleResetPasswordModal}\n                enableApp={enableApp}\n                logoutClient={logoutClient}\n            />\n        </Dialog>\n    );\n};\n\nResetPasswordModal.propTypes = {\n    disableApp: PropTypes.func,\n    enableApp: PropTypes.func,\n    is_loading: PropTypes.bool,\n    is_visible: PropTypes.bool,\n    logoutClient: PropTypes.func,\n    toggleResetPasswordModal: PropTypes.func,\n    verification_code: PropTypes.string,\n};\n\nexport default connect(({ ui, client }) => ({\n    is_visible: ui.is_reset_password_modal_visible,\n    enableApp: ui.enableApp,\n    disableApp: ui.disableApp,\n    is_loading: ui.is_loading,\n    logoutClient: client.logout,\n    toggleResetPasswordModal: ui.toggleResetPasswordModal,\n    verification_code: client.verification_code.reset_password,\n}))(ResetPasswordModal);\n"],"sourceRoot":""}